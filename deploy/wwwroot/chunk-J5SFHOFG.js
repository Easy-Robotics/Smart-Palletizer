import{a as pe,d as ce}from"./chunk-O2475MJB.js";import{a as de,b as ge}from"./chunk-LZP6B7YF.js";import{a as se}from"./chunk-2Z6T37XV.js";import{$ as B,A as O,Ba as U,D as R,E as o,F as h,K as A,L as g,Lb as ee,M as L,Mb as te,O as l,P as a,Pb as ie,Q as P,Rb as ne,Sa as j,Sb as re,Tb as oe,U as N,Ua as F,V as f,Wb as ae,Xb as M,Ya as X,Yb as le,Z as T,_ as D,_a as H,a as w,ba as _,ca as b,da as E,fa as C,fb as Q,ga as S,ha as y,hb as q,ia as x,ib as Z,ja as V,ka as W,ma as u,na as m,q as G,qa as k,u as I,va as Y,xb as J,y as c,ya as z,yb as K,z as d,zb as $}from"./chunk-KHVE27WA.js";var ue=(()=>{class p extends le{constructor(){super(...arguments),this.baseUrl=`${M.baseUrl}/${M.prefix}/MultiGripper`}getPalletizerResultWithSchemaAndGripperAsync(i){return this.post(`${this.baseUrl}/palletizer-result`,i)}syncPalletizerResultToPLC(i){return this.post(`${this.baseUrl}/sync-plc`,i)}static{this.\u0275fac=(()=>{let i;return function(e){return(i||(i=O(p)))(e||p)}})()}static{this.\u0275prov=G({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();var Ce=["patternCanvas"],Se=p=>({overflow:p}),ye=()=>({position:"absolute",top:"50%",left:"50%","z-index":"1155"});function _e(p,Pe){p&1&&P(0,"p-progressSpinner",24),p&2&&L(V(2,ye))}var je=(()=>{class p{constructor(i,t,e,r,s,n,me){this.generatorConfigService=i,this.layoutSchemaService=t,this.multiGripperService=e,this.messageService=r,this.translateService=s,this.dialogService=n,this.changeDetectorRef=me,this.generatorConfigSelections=[],this.layoutSchemaSelections=[],this.layerSelections=[],this.offsetDirectionOptions=[{label:"X",value:!0},{label:"Y",value:!1}],this.maxNumberOfGrippers=4,this.offsetIndex=1,this.multiGripperConfiguration={useMultiGripper:!0,numberOfGrippers:2,offsetInXDirection:!1,offset:[{XY:-200},{XY:200}]},this.productsOnPallet=void 0,this.blockedDocument=!1;let v=this.translateService.getBrowserLang();v=v.match(/en|zh/)?v:"en",this.imagPath=`assets/imgs/pattern-graphic/${v}/GripperGraph.png`}ngOnInit(){this.initGeneratorConfigSelections()}ngOnDestroy(){this.dialogRef&&this.dialogRef.close()}onGeneratorConfigurationChanged(){this.generatePattern(),this.initLayoutSchemaSelections()}onLayoutSchemaChanged(){if(this.layoutSchemaIdSelected==null)this.generatePattern();else{let i={generatorConfigurationId:this.generatorConfigIdSelected,layoutSchemaId:this.layoutSchemaIdSelected};this.layoutSchemaService.getPalletizerResultWithSchemaAsync(i).subscribe(t=>{t&&(t.schemaMatch?this.messageService.add({severity:"success",summary:this.translateService.instant("MESSAGE.SUCCESS"),detail:this.translateService.instant("LAYER_PAGE.SCHEMA_LOAD_DETAIL")}):this.messageService.add({severity:"warn",summary:this.translateService.instant("MESSAGE.WARN"),detail:this.translateService.instant("LAYER_PAGE.SCHEMA_LOAD_WARN")}),this.palletizingData=w({},t),this.updatelayerSelections(),this.renderPatternResult(this.patternCanvas.nativeElement,this.palletizingData))})}}updateLayerPositions(){this.renderPatternResult(this.patternCanvas.nativeElement,this.palletizingData)}applyMultiGripperOnPattern(){this.multiGripperConfiguration.useMultiGripper=!0,this.calcMultiGripperPattern()}removeMultiGripperOnPattern(){this.multiGripperConfiguration.useMultiGripper=!1,this.calcMultiGripperPattern()}onGripperNumberChanged(i){let t=i;if(this.multiGripperConfiguration.offset.length<t)for(let e=this.multiGripperConfiguration.offset.length;e<t;e++)this.multiGripperConfiguration.offset.push({XY:0});this.multiGripperConfiguration.offset.length>t&&(this.offsetIndex=t,this.multiGripperConfiguration.offset=this.multiGripperConfiguration.offset.slice(0,t))}onLoadToPlcClicked(){this.dialogRef=this.dialogService.open(ge,{header:this.translateService.instant("SYNC_PLC.ASSIGN_ENDPOINT"),width:"500px",contentStyle:{"max-height":"80vh",overflow:"auto"},baseZIndex:1e4}),this.dialogRef.onClose.subscribe(i=>{i&&this.syncDataToPlc(i)})}calcMultiGripperPattern(){let i={generatorConfigurationId:this.generatorConfigIdSelected,layoutSchemaId:this.layoutSchemaIdSelected,gripperConfiguration:this.multiGripperConfiguration};this.multiGripperService.getPalletizerResultWithSchemaAndGripperAsync(i).subscribe(t=>{t&&(t.schemaMatch||this.messageService.add({severity:"warn",summary:this.translateService.instant("MESSAGE.WARN"),detail:this.translateService.instant("LAYER_PAGE.SCHEMA_LOAD_WARN")}),t.errorMessage!=null&&t.errorMessage!==""&&(console.log("Error Message:",t.errorMessage),this.messageService.add({severity:"error",summary:this.translateService.instant("MESSAGE.ERROR"),detail:t.errorMessage})),this.maxNumberOfGrippers=t.maxNumberOfGripper,this.palletizingData=w({},t),this.updatelayerSelections(),this.renderPatternResult(this.patternCanvas.nativeElement,this.palletizingData))})}initGeneratorConfigSelections(){this.generatorConfigService.getGeneratorConfigOverview().subscribe(i=>{i&&(this.generatorConfigSelections=i.map(t=>({label:t.name,value:t.id})))})}generatePattern(){this.generatorConfigService.GetPalletizingResult(this.generatorConfigIdSelected).subscribe(i=>{i&&(this.productsOnPallet=i.generatorResults.resultData.numberOfProductsOnPallet,this.palletizingData=w({},i),this.updatelayerSelections(),this.renderPatternResult(this.patternCanvas.nativeElement,this.palletizingData),this.messageService.add({severity:"success",summary:this.translateService.instant("MESSAGE.SUCCESS"),detail:this.translateService.instant("LAYER_PAGE.PATTERN_LOAD_DETAIL")}))})}initLayoutSchemaSelections(){this.layoutSchemaService.getLayoutSchemaOverview().subscribe(i=>{if(i&&i.findIndex(t=>t.generatorConfigutationId===this.generatorConfigIdSelected)!==-1){let t=i.find(e=>e.generatorConfigutationId===this.generatorConfigIdSelected)?.layoutSchemaIdNameMap||{};this.layoutSchemaSelections=Object.entries(t).map(([e,r])=>({label:r,value:e})),this.layoutSchemaSelections.unshift({label:"None",value:null})}else this.layoutSchemaSelections=[]})}updatelayerSelections(){this.layerSelections=[],this.palletizingData.generatorResults.layerStackingData.forEach((i,t)=>{this.layerSelections.push({label:`L${t+1}`,value:t,mapper:i.layerLayoutIndex})}),this.layerIndexSelected=0}renderPatternResult(i,t){try{let r=this.layerSelections.find(n=>n.value===this.layerIndexSelected).mapper,s=pe(i,t.generatorConfiguration.palletData);ce(i,t,s,r,this.layerIndexSelected)}catch(e){this.messageService.add({severity:"warn",summary:this.translateService.instant("MESSAGE.WARN"),detail:e.message||this.translateService.instant("MESSAGE.RENDERING_WARN")})}}syncDataToPlc(i){this.blockedDocument=!0;let t={generatorConfigurationId:this.generatorConfigIdSelected,layoutSchemaId:this.layoutSchemaIdSelected,endpointUrl:i,gripperConfiguration:this.multiGripperConfiguration};this.multiGripperService.syncPalletizerResultToPLC(t).subscribe({next:e=>{e.success?this.messageService.add({severity:"success",summary:this.translateService.instant("MESSAGE.SUCCESS"),detail:this.translateService.instant("SYNC_PLC.SYNC_DETAIL_SUCCESS")}):this.messageService.add({severity:"warn",summary:this.translateService.instant("MESSAGE.WARN"),detail:this.translateService.instant("SYNC_PLC.SYNC_DETAIL_WARN",{message:e.message})})},error:e=>{this.messageService.add({severity:"error",summary:this.translateService.instant("MESSAGE.ERROR"),detail:this.translateService.instant("SYNC_PLC.SYNC_DETAIL_ERROR",{error:e})}),setTimeout(()=>{this.blockedDocument=!1,this.changeDetectorRef.markForCheck()},1e3)},complete:()=>{setTimeout(()=>{this.blockedDocument=!1,this.changeDetectorRef.markForCheck()},1e3)}})}static{this.\u0275fac=function(t){return new(t||p)(h(se),h(de),h(ue),h(Q),h(ne),h(ae),h(k))}}static{this.\u0275cmp=I({type:p,selectors:[["app-config-gripper-page"]],viewQuery:function(t,e){if(t&1&&T(Ce,5),t&2){let r;D(r=B())&&(e.patternCanvas=r.first)}},standalone:!0,features:[x],decls:49,vars:56,consts:[["patternCanvas",""],[1,"content-layout"],[1,"content-header",2,"flex","0 1 auto"],[1,"label"],[1,"header-block"],[1,"dropdown-block"],["optionLabel","label","optionValue","value",3,"ngModelChange","onChange","placeholder","options","ngModel"],["icon","pi pi-download",3,"onClick","label","disabled"],[3,"blocked"],["ariaLabel","loading",3,"style",4,"ngIf"],[1,"content-wrapper",2,"flex","1 1 auto"],[1,"content-left"],[1,"gripper-param-container"],["buttonLayout","horizontal","incrementButtonIcon","pi pi-plus","decrementButtonIcon","pi pi-minus","decrementButtonClass","p-button-secondary","incrementButtonClass","p-button-secondary",3,"ngModelChange","min","max","showButtons","ngModel"],[3,"onClick","label","disabled"],["optionLabel","label","optionValue","value",3,"ngModelChange","options","ngModel"],["buttonLayout","horizontal","incrementButtonIcon","pi pi-arrow-right","decrementButtonIcon","pi pi-arrow-left","decrementButtonClass","p-button-secondary","incrementButtonClass","p-button-secondary",3,"ngModelChange","min","max","showButtons","ngModel"],["pInputText","","type","number",2,"max-width","120px",3,"ngModelChange","ngModel"],["placeholder","Select a layer layout","optionLabel","label","optionValue","value",3,"ngModelChange","onChange","options","ngModel"],[2,"width","100%","padding","0 3rem"],["alt","Gripper Image","loading","lazy",2,"width","100%","height","100%","object-fit","contain",3,"src"],[1,"content-right",3,"ngStyle"],[1,"pattern-graph"],["width","400","height","400"],["ariaLabel","loading"]],template:function(t,e){if(t&1){let r=N();l(0,"div",1)(1,"div",2)(2,"label",3),_(3),u(4,"translate"),a(),l(5,"div",4)(6,"div",5)(7,"p-dropdown",6),u(8,"translate"),y("ngModelChange",function(n){return c(r),S(e.generatorConfigIdSelected,n)||(e.generatorConfigIdSelected=n),d(n)}),f("onChange",function(){return c(r),d(e.onGeneratorConfigurationChanged())}),a()(),l(9,"div",5)(10,"p-dropdown",6),u(11,"translate"),y("ngModelChange",function(n){return c(r),S(e.layoutSchemaIdSelected,n)||(e.layoutSchemaIdSelected=n),d(n)}),f("onChange",function(){return c(r),d(e.onLayoutSchemaChanged())}),a()(),l(12,"p-button",7),u(13,"translate"),f("onClick",function(){return c(r),d(e.onLoadToPlcClicked())}),a(),P(14,"p-blockUI",8),A(15,_e,1,3,"p-progressSpinner",9),a()(),l(16,"div",10)(17,"div",11)(18,"div",12)(19,"label"),_(20),u(21,"translate"),a(),l(22,"p-inputNumber",13),y("ngModelChange",function(n){return c(r),S(e.multiGripperConfiguration.numberOfGrippers,n)||(e.multiGripperConfiguration.numberOfGrippers=n),d(n)}),f("ngModelChange",function(n){return c(r),d(e.onGripperNumberChanged(n))}),a(),l(23,"p-button",14),u(24,"translate"),f("onClick",function(){return c(r),d(e.applyMultiGripperOnPattern())}),a(),l(25,"p-button",14),u(26,"translate"),f("onClick",function(){return c(r),d(e.removeMultiGripperOnPattern())}),a()(),l(27,"div",12)(28,"label"),_(29),u(30,"translate"),a(),l(31,"p-selectButton",15),y("ngModelChange",function(n){return c(r),S(e.multiGripperConfiguration.offsetInXDirection,n)||(e.multiGripperConfiguration.offsetInXDirection=n),d(n)}),a()(),l(32,"div",12)(33,"label"),_(34),u(35,"translate"),a(),l(36,"p-inputNumber",16),y("ngModelChange",function(n){return c(r),S(e.offsetIndex,n)||(e.offsetIndex=n),d(n)}),a(),l(37,"input",17),y("ngModelChange",function(n){return c(r),S(e.multiGripperConfiguration.offset[e.offsetIndex-1].XY,n)||(e.multiGripperConfiguration.offset[e.offsetIndex-1].XY=n),d(n)}),a()(),l(38,"div",12)(39,"label"),_(40),u(41,"translate"),a(),l(42,"p-dropdown",18),y("ngModelChange",function(n){return c(r),S(e.layerIndexSelected,n)||(e.layerIndexSelected=n),d(n)}),f("onChange",function(){return c(r),d(e.updateLayerPositions())}),a()(),l(43,"div",19),P(44,"img",20),a()(),l(45,"div",21)(46,"div",22),P(47,"canvas",23,0),a()()()()}t&2&&(o(3),E("",m(4,34,"GRIPPER_PAGE.CONFIGURATION_SELECTION_LABEL")," *"),o(4),g("placeholder",m(8,36,"GRIPPER_PAGE.CONFIGURATION_SELECTION_PLACEHOLDER"))("options",e.generatorConfigSelections),C("ngModel",e.generatorConfigIdSelected),o(3),g("placeholder",m(11,38,"LAYER_PAGE.LAYOUT_SCHEMA_SELECTION_PLACEHOLDER"))("options",e.layoutSchemaSelections),C("ngModel",e.layoutSchemaIdSelected),o(2),g("label",m(13,40,"BUTTON.SYNC_PLC"))("disabled",!e.generatorConfigIdSelected),o(2),g("blocked",e.blockedDocument),o(),g("ngIf",e.blockedDocument),o(5),b(m(21,42,"GRIPPER_PAGE.GRIPPER_NUMBER_LABEL")),o(2),g("min",2)("max",e.maxNumberOfGrippers)("showButtons",!0),C("ngModel",e.multiGripperConfiguration.numberOfGrippers),o(),g("label",m(24,44,"BUTTON.CALC"))("disabled",!e.generatorConfigIdSelected),o(2),g("label",m(26,46,"BUTTON.RESET"))("disabled",!e.generatorConfigIdSelected),o(4),b(m(30,48,"GRIPPER_PAGE.GRIPPER_OFFSET_DIRECTION_LABEL")),o(2),g("options",e.offsetDirectionOptions),C("ngModel",e.multiGripperConfiguration.offsetInXDirection),o(3),E("",m(35,50,"GRIPPER_PAGE.OFFSET_DISTANCE_LABEL")," (mm)"),o(2),g("min",1)("max",e.multiGripperConfiguration.numberOfGrippers)("showButtons",!0),C("ngModel",e.offsetIndex),o(),C("ngModel",e.multiGripperConfiguration.offset[e.offsetIndex-1].XY),o(3),b(m(41,52,"GRIPPER_PAGE.SELECT_LAYER_LABEL")),o(2),g("options",e.layerSelections),C("ngModel",e.layerIndexSelected),o(2),g("src",e.imagPath,R),o(),g("ngStyle",W(54,Se,e.productsOnPallet?"auto":"hidden")))},dependencies:[ie,Z,q,J,K,j,H,F,X,$,ee,te,U,Y,z,oe,re],styles:[".content-layout[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.content-layout[_ngcontent-%COMP%]   .content-header[_ngcontent-%COMP%]{padding:1rem 1.75rem}.content-layout[_ngcontent-%COMP%]   .content-header[_ngcontent-%COMP%]   .header-block[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:flex-end;justify-content:flex-start;width:100%;min-width:600px;gap:1rem}.content-layout[_ngcontent-%COMP%]   .content-header[_ngcontent-%COMP%]   .header-block[_ngcontent-%COMP%]   .dropdown-block[_ngcontent-%COMP%]{width:45%;max-width:300px;padding-top:.5rem}.content-layout[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;height:100%;overflow-y:auto;scrollbar-width:thin;border-top:solid 2px #e5e7eb}.content-layout[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .content-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:50%;min-width:600px;margin-bottom:48px;padding:1rem 1.75rem;gap:1rem;overflow-y:auto;scrollbar-width:thin}.content-layout[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .content-left[_ngcontent-%COMP%]   .gripper-param-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:1rem;width:100%}.content-layout[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .content-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:50%;border-left:solid 2px #e5e7eb;margin-bottom:48px;overflow-y:auto;scrollbar-width:thin}.content-layout[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .content-right[_ngcontent-%COMP%]   .pattern-graph[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;min-width:450px;min-height:450px;margin:1rem}.content-layout[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   .content-right[_ngcontent-%COMP%]   .pattern-graph[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}[_nghost-%COMP%]     .p-dropdown{min-width:100%}[_nghost-%COMP%]     .p-inputnumber-input{width:50px}[_nghost-%COMP%]     .p-inputnumber-button{border-color:#d3d3d3;color:#a9a9a9;background-color:transparent}"]})}}return p})();export{je as ConfigGripperPageComponent};
